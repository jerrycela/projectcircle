# ProjectCircle UI 全面改造計畫

> 日期：2026-02-19
> 狀態：設計階段（色彩與基礎規則已確認方向，各畫面細節待確認）

---

## 一、本次工作進度

### 已完成：怪物數量 Bug 修復

**問題**：怪物發射後，底部卡片的數量（x5）永遠不會減少。

**根因**：
1. `launchMonster()` 發射怪物後沒有從 `run.monsters` 庫存中移除
2. `updateDeployPanel()` 每幀更新冷卻但從不更新 `countText`
3. `MONSTER_DEPLOYED` 事件發出後無人監聽

**修復內容**（2 個檔案，+36 / -6 行）：
- `src/state/actions.ts` — 新增 `consumeMonsterFromInventory()` 純函式
- `src/phases/battle-phase.ts` — 發射後呼叫庫存扣除 + 每幀刷新數量角標

**已知副作用（待修）**：
- `actions.ts:179` 出現 "Monster goblin not found" 警告 — 結算階段找不到已消耗的怪物來發經驗值
- `result-phase.ts:190` 出現 null reference crash — Tween 回調中讀取已銷毀物件

### 已完成：發射台位置 + 卡片切換修復（前次遺留）

- 發射台 Y 座標從 `ROOM_HEIGHT - 15` 改為 `ROOM_HEIGHT * 0.82`
- 移除瞄準模式退出時的 `return`，允許一鍵切換卡片

---

## 二、UI 問題總覽

### 全域問題

| 問題 | 影響 |
|------|------|
| 色調太暗、對比度低 | 整體看起來灰濛濛，資訊難以辨識 |
| 字體太小（最小 9px） | 手機上幾乎看不清楚 |
| 中英文混雜 | "Next bonus"、"Owned"、"ATK SPD" 等英文散落各處 |
| 面板資訊過擠 | 卡片內塞太多文字，沒有呼吸空間 |
| 「玻璃質感」面板太模糊 | 6 層漸層堆疊反而讓邊界不清晰 |
| 缺乏操作引導 | 新手不知道該點哪裡（門、發射台等） |

### 各畫面問題

#### 主選單（MenuScene）
- 標題和按鈕佔畫面比例小，大量空間浪費
- 缺少遊戲氛圍感

#### 探索階段（ExplorePhase）
- 陣型槽位（前排/左後/右後）在深色地板上幾乎看不見
- 門的入口太小，沒有引導提示
- 消耗品欄卡片擠在一起，價格和名稱不夠醒目

#### 戰鬥階段（BattlePhase）
- 部署卡片 + 數量選擇器 + 發射台三者空間衝突
- 提示文字「選擇數量，按發射台射出」太小太淡
- 被選中的卡片沒有明顯的「選中」效果
- 瞄準模式的回饋不夠強烈

#### 結算階段（ResultPhase）
- 房間選擇卡片資訊爆炸 — "Next bonus"、"Owned"、詳細說明全擠在 105px 寬的卡片裡
- 進化選擇面板英文混雜（"is ready to evolve!"）
- XP 進度條太小，缺乏成就感

---

## 三、設計方向：精緻像素風格

保留現有像素角色素材，但 UI 框架全面升級為高品質像素藝術風格（參考《吸血鬼倖存者》《怪物火車》）。

### 3.1 新色彩系統

| 用途 | 舊值 | 新值 | 說明 |
|------|------|------|------|
| 面板底色 `UI_BG` | `#0c0c14` | `#1a1428` | 深紫帶暖，不再死黑 |
| 卡片底色 `UI_PANEL` | `#16161e` | `#221a30` | 深紫，跟底色有區分 |
| 主邊框 `UI_BORDER` | `#3a3a4e` | `#6a5acd` | 中紫，像素風常見色 |
| 高光邊框 `UI_BORDER_LIGHT` | `#5a5a6e` | `#8a7ae8` | 亮紫，邊框高光 |
| 主文字 `UI_TEXT` | `#eeeeee` | `#f0e8d8` | 暖白，閱讀更舒適 |
| 次要文字 `UI_TEXT_DIM` | `#888899` | `#a8a0b8` | 淡紫灰，比舊色亮很多 |
| 強調色 `UI_ACCENT` | `#5588aa` | `#ffaa33` | 暖金橙，搶眼有活力 |
| 金幣色 `UI_GOLD` | `#d4aa44` | `#ffd700` | 標準亮金 |
| 危險色 `UI_DANGER` | `#cc4444` | `#ff5555` | 更明亮的警示紅 |
| 成功色 `UI_SUCCESS` | `#44aa66` | `#55dd88` | 更明亮的治療綠 |
| 我方色 `ALLY_COLOR` | `#4a7a8a` | `#55bbdd` | 更亮的友方藍 |
| 敵方色 `ENEMY_COLOR` | `#b89a6a` | `#dd8844` | 更亮的敵方橙 |

### 3.2 字體規則

- 全面中文化 — 消滅所有殘留英文
- 最小字體 **12px**（目前有 9px、10px 的元素）
- 主要資訊至少 **14-16px**
- 標題 **20-24px**
- 所有文字加 **2-3px 黑色描邊**
- 數值類使用 `monospace`，名稱類使用預設字體

### 3.3 面板/卡片風格

**舊風格（6 層玻璃漸層）→ 新風格（像素實邊框）：**

- 2px 實色邊框（主邊框色）
- 純色填充（卡片底色）
- 頂部 1px 高光線（高光邊框色）
- 底部 1px 暗線（加深版底色）
- 卡片間距從 4-6px 增加到 8-12px
- 卡片內部 padding 從 2-4px 增加到 8px

### 3.4 互動回饋

- 按鈕按下：亮度提升 + 1px 向下位移（像素風標準回饋）
- 卡片選中：邊框變為強調色 + 輕微放大（1.05x）
- 不可用狀態：灰度 + 降低透明度（而非蓋黑色遮罩）
- 門入口：加閃爍邊框 + 引導箭頭動畫

---

## 四、各畫面改造計畫

### 4.1 主選單（MenuScene）

- 標題加大到 42px，加像素風陰影
- 副標題改中文「地牢防禦戰」
- 開始按鈕加大到 260x72px，加像素風 3D 按鈕效果（頂部亮、底部暗）
- 背景加入緩慢漂浮的像素粒子和微弱的地牢剪影

### 4.2 頂部 HUD（UIScene）

- 金幣區改為：金幣圖示 + 數字，加金色底框
- 怪物上限改為：怪物頭圖示 + "N/5"，加說明
- 波次資訊加大，改為中文「第 N 波 / 共 M 波」
- 敵人數改中文「剩餘敵人：N」

### 4.3 探索階段（ExplorePhase）

- 陣型槽位：加粗虛線圓圈 + 更大的中文標籤
- 門入口：加大門圖形 + 難度指示用大號中文標籤（「簡單」「普通」「困難」）+ 引導動畫
- 消耗品欄：卡片加大到 90x70px，名稱 14px，價格 14px 金色粗體

### 4.4 戰鬥階段（BattlePhase）

- 部署卡片加大到 100x70px，圖示和名稱更大
- 數量選擇器移到卡片正上方（而非和發射台重疊）
- 提示文字改為 14px + 半透明背景條
- 瞄準線加粗、箭頭加大
- 力道指示改為更直覺的弧形條
- 傷害數字加大到 16-20px，加彈出動畫
- 波次切換提示加大，中文「下一波來了！」

### 4.5 結算階段（ResultPhase）

- 戰鬥結算面板：金幣動畫更華麗，XP 條加大加粗
- 進化選擇：全中文（「哥布林準備進化！」），卡片加大顯示屬性
- 房間選擇：卡片加大到 120x200px，資訊分層（圖示 → 名稱 → 效果 → 細節）
- 屬性標籤全中文化（「生命」「攻擊」「速度」）
- 失敗畫面：加大統計文字，「再試一次」按鈕更醒目

### 4.6 特效升級

- 傷害數字：更大、更有彈性的動畫
- 治療數字：加心形粒子
- 死亡效果：加像素爆散動畫
- 波次過渡：更有氣勢的倒計時（數字加大 + 震動效果）

---

## 五、實作順序（建議）

| 優先級 | 任務 | 影響範圍 |
|--------|------|---------|
| P0 | 修復庫存消耗導致的結算 bug | actions.ts, result-phase.ts |
| P1 | 更新色彩常數 + drawPanel 函式 | constants.ts, visual-factory.ts（全域影響） |
| P2 | 戰鬥階段 UI 改造 | battle-phase.ts |
| P3 | 結算階段 UI 改造 | result-phase.ts |
| P4 | 探索階段 UI 改造 | explore-phase.ts |
| P5 | HUD + 主選單改造 | UIScene.ts, MenuScene.ts |
| P6 | 特效升級 | battle-phase.ts, visual-factory.ts |
| P7 | 文字全面中文化 | 所有含 UI 文字的檔案 |

---

## 六、相關檔案清單

| 檔案 | 用途 |
|------|------|
| `src/config/constants.ts` | 色彩常數、尺寸常數 |
| `src/utils/visual-factory.ts` | drawPanel、血條等共用 UI 元件 |
| `src/utils/texture-factory.ts` | 像素素材生成 |
| `src/scenes/MenuScene.ts` | 主選單 |
| `src/scenes/UIScene.ts` | 頂部 HUD |
| `src/scenes/DungeonScene.ts` | 走廊過場 |
| `src/phases/explore-phase.ts` | 探索階段（槽位、門、消耗品欄）|
| `src/phases/battle-phase.ts` | 戰鬥階段（部署、發射、瞄準、特效）|
| `src/phases/result-phase.ts` | 結算階段（金幣、XP、進化、房間選擇）|
| `src/state/actions.ts` | 遊戲狀態操作函式 |
